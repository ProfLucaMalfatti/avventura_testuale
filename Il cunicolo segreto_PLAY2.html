<!DOCTYPE html><html lang="it"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Il cunicolo segreto</title><style>html,body{height:100%}body{margin:0;background:#0b1220;color:#e5e7eb;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif}.app{min-height:100vh;display:grid;place-items:center;padding:20px}.card{max-width:850px;width:min(860px,92vw);background:#0f172a;border:1px solid #1f2937;border-radius:14px;padding:20px;box-shadow:0 20px 60px rgba(0,0,0,.35)}h1{margin:0 0 8px}.small{color:#94a3b8;font-size:12px}input{width:100%;background:#0b1220;color:#e5e7eb;border:1px solid #1f2937;border-radius:10px;padding:10px}.msg{margin-top:10px;font-size:14px}.msg.warn{color:#f59e0b}</style></head><body><div class="app"><div class="card" id="root"><div class="small">Caricamento…</div></div></div><script>(function(){  const story = {"title":"Il cunicolo segreto","start":"introduzione","nodes":[{"id":"introduzione","text":"Benvenutə {{nome}}!\\n\\nIn questa avventura DEVI DIGITARE i comandi: non ci sono pulsanti.\\nEsempi: \"attraverso la porta\", \"vai a sinistra\", \"esamina porta\".\\n\\n\nIn ogni nuova scena in cui ti troverai ti verrà data una descrizione di cosa hai intorno e cosa hai eventualmente in quattro direzioni (nord, sud, ovest, est). Potrai provare ad interagire con gli oggetti presenti oppure andare in una delle direzioni proposte.\\n\\n\\n\nPer iniziare l'avventura, digita \"inizio l'avventura\"","choices":[{"label":"inizio l'avventura","target":"stanza0"}]},{"id":"stanza0","text":"Oggi doveva essere solo una passeggiata nel bosco. Ma mentre stai camminando pensando ai fatti tuoi... Il terreno ti si apre sotto i piedi e tu… precipiti in un cunicolo umido e buio. Lo smartphone non ha linea ma almeno la batteria regge.\\nL’aria sa di roccia e… di qualcosa di antico. Ti senti osservato.\\n\\n\nNon riesci a vedere nulla e fino a che non avrai una fonte di luce hai paura a muoverti.\nCosa fai?","choices":[{"label":"smartphone|cellulare|accendo la torcia|torcia|prendo il cellulare|prendo lo smartphone|uso la torcia","target":"stanza1"}]},{"id":"stanza1","text":"La torcia del cellulare illumina pareti coperte di segni. A est un passaggio stretto, a ovest una nicchia, a nord un corridoio che scende. Dietro di te, sul muro, c'è una scritta incisa con qualcosa di affilato: “Tre simboli aprono la porta”.","choices":[{"label":"nicchia|osservo la nicchia|guardo dentro la nicchia","target":"nicchia1"},{"label":"vado a est|cammino verso est|entro nel passaggio stretto","target":"corridoio1"},{"label":"vado a nord|scendo nel corridoio|corridoio","target":"stanza2"},{"label":"vai avanti|prosegui","target":""}]},{"id":"nicchia1","text":"La nicchia custodisce un pannello metallico. Sopra, una frase: “Distingui l’ombra dal riflesso”. Sotto, un display chiede di risolvere un confronto tra decimali.\\n\nDietro di te, a est, la stanza da cui sei venuto.","choices":[{"label":"torno indietro|indietro|vado a ovest|vado verso ovest","target":"stanza1"},{"label":"spengo la torcia","target":"nicchia1nolig"}],"quiz":{"items":[{"prompt":"7,08 □ 7,8","ok":["<"]},{"prompt":"0,506 □ 0,56","ok":["<"]},{"prompt":"0,7 □ 0,70","ok":["="]},{"prompt":"3,45  □  3,450","ok":["="]},{"prompt":"0,909 □ 0,99","ok":["<"]}],"onCorrect":"nicchiaok"}},{"id":"nicchiaok","text":"Uno scatto, il pannello metallico si apre rivelando un piccolo ciondolo con inciso un ramo spinoso con dei fiori.\\n\nPrendi il sigillo e sotto trovi un biglietto con scritto \"Il primo dei tre\".\nTorna indietro.","choices":[{"label":"torno indietro|indietro","target":"stanza1"}]},{"id":"stanza2","text":"Sei in una stanza con l'acqua fino alle caviglie, l'aria è ancora più pesante e umida. Illumini le pareti fatte di mattoni rossi ma non vedi nulla di strano, a nord un altro corridoio di cui non vedi la fine. A sud, la prima stanza.","choices":[{"label":"vado a sud|sud","target":"stanza1"},{"label":"nord|vado a nord","target":"stanza3"},{"label":"spengo la luce","target":"stanza2nolig"}]},{"id":"stanza3","text":"Sei in una stanza senza altre uscite, hai l'acqua fino alle ginocchia.\\n\nLe pareti sono piene di muffa. Nascosto in un angolo c'è una piccola grata chiusa da un lucchetto a combinazione e sopra il lucchetto ci sono simboli matematici:","choices":[{"label":"vado a sud|sud","target":""}],"quiz":{"items":[{"prompt":"6 · (40+5)","ok":["6x40+6x5","6x5+6x40"]},{"prompt":"(10+2) · 30=","ok":["10x30+2x30","30x10+30x2","2x30+10x30","30x2+10x30"]},{"prompt":"25 · (12-8)=","ok":["25x12-25x18","25x18-25x12"]}],"onCorrect":"stanza3ok"}},{"id":"stanza3ok","text":"Il lucchetto scatta e la grata si apre rivelando una grossa chiave con incisi simboli matematici.\\n\nSenti una voce che da dietro le pareti sussurra \"Secondo di tre\".\\n\nTorna indietro.","choices":[{"label":"torno indietro|indietro","target":"stanza2"}]},{"id":"corridoio1","text":"Ti trovi davanti ad una porta chiusa.\\n\nA sud il corridoio che porta alla prima stanza.","choices":[{"label":"osservo la porta|controllo la porta|guardo la porta|mi avvicino alla porta","target":"porta1"},{"label":"vado verso sud|sud|verso sud|vado a sud","target":"stanza1"},{"label":"spengo la torcia","target":"corridoio1nolig"}]},{"id":"porta1","text":"Osservi la porta e noti un tastierino numerico con dei numeri e simboli matematici.\\n\nSopra di esso, scritto con una penna c'è la seguente operazione:","choices":[],"quiz":{"items":[{"prompt":"2^5 · 2^3 : 2^2 □ 3· (31-9)=","ok":["<"]},{"prompt":"3^4 · 2^4 : 1^4 □ 15· (12+11)=","ok":[">"]},{"prompt":"3^4 · 2^4 : 1^4 □ (6^2)^2","ok":["="]}],"onCorrect":"corridoio2"}},{"id":"stanza4","text":"La torcia illumina una stanza stretta, dal soffitto basso. L’unica via d’uscita è un corridoio che punta a ovest. L’aria sa di gesso umido. Per un istante ti pare che una delle pareti “trattenga” la luce un attimo più del dovuto, come se fosse stata ritoccata di recente… poi tutto torna immobile.","choices":[{"label":"osservo parete|esamino parete|guardo parete|osservo la parete|guardo la parete|esamina la parete","target":"segreto1"},{"label":"vado a ovest|ovest","target":"stanza5"},{"label":"spengo la torcia","target":"stanza4nolig"}]},{"id":"segreto1","text":"Avvicini la torcia: sotto il velo di gesso vedi graffi sottili che formano righe spezzate, quasi un’ombra di scrittura. Con la punta delle dita sollevi un granello: affiora un segno più netto, una piccola runa a forma di triangolo incompleto incisa su un mattone.","choices":[{"label":"torno indietro|indietro","target":"stanza4"},{"label":"tocco il mattone|muovo il mattone|sposto il mattone|tocco il segno","target":"alfio"}]},{"id":"alfio","text":"Il mattone con sopra le incisioni si muove e dietro di esso trovi una disegno di un gattino bianco e nero. La metti in tasca.\\n\nTorna indietro.","choices":[{"label":"torno indietro|indietro","target":"stanza4"}]},{"id":"stanza1nolig","text":"non vedi niente","choices":[{"label":"accendo la torcia","target":"stanza1"}]},{"id":"nicchia1nolig","text":"non vedi nulla","choices":[{"label":"accendo la torcia","target":"nicchia1"}]},{"id":"stanza2nolig","text":"Con la luce spenta un bagliore coglie la tua attenzione, alzi gli occhi e vedi una scritta verde fosforescente \"2E was here\".\\n\n","choices":[{"label":"accendo la torcia","target":""}]},{"id":"corridoio1nolig","text":"Non vedi nulla. Senti dei sussurri oltre la porta ma non riesci a capire.","choices":[{"label":"accendo la torcia","target":"corridoio1"}]},{"id":"stanza4nolig","text":"La stanz aè completamente buia ad eccezione di una parte di una parete che emana una leggera luce verde.","choices":[{"label":"osservo la parete|mi avvicino alla parete|osservo la luce verde|osservo la luce|mi avvicino alla luce|guardo la luce","target":"segreto1"}]},{"id":"stanza5","text":"Ti ritrovi in una stanza più grande delle altre, a sud una porta di legno pesante con una maniglia di ottone, a nord una breccia nel muro rivela un cunicolo stretto, a ovest un corridoio porta in un'altra stanza.","choices":[{"label":"spengo la torcia","target":"stanza5nolig"},{"label":"vado a ovest|ovest|","target":"stanza6"},{"label":"vado a nord|nord","target":"stanza7"},{"label":"vado a est|est","target":"stanza4"},{"label":"osservo la porta|guardo la porta|mi avvicino alla porta","target":"porta2"}]},{"id":"stanza5nolig","text":"Noti un bagliore uscire da sotto la porta di legno chiusa. \\n\nTutto il resto è buio","choices":[{"label":"accendo la torcia","target":"stanza5"}]},{"id":"porta2","text":"Osservi la porta, sembra abbastanza resistente.\\n\nTutto è impolverato, tranne la maniglia, probabilmente qualcuno la aperta di recente.","choices":[{"label":"torno indietro|indietro","target":"stanza5"},{"label":"apro la maniglia|apro la porta|impugno la maniglia","target":"porta2clos"},{"label":"sfondo la porta|do un colpo alla porta|do un calcio alla porta","target":"infortunio"}]},{"id":"porta2clos","text":"La maniglia si muove ma la porta è chiusa.\\n\nDall'altra parte senti qualcuno che si muove.","choices":[{"label":"torno indietro|indietro","target":"stanza5"}]},{"id":"infortunio","text":"Ti sei infortunato, vai dal professore e diglielo.","choices":[{"label":"torno indietro|indietro","target":"porta2"}]},{"id":"stanza6","text":"Nella stanza le parete sono quasi crollate rivelando la terra con qualche radice.\\n\nNoti qualcosa sotto ai mattoni caduti a terra.\\n\nA est il corridoio che porta alla stanza precedente.","choices":[{"label":"vado a est|est","target":"stanza5"},{"label":"mi avvicino ai mattoni|vado a vedere i mattoni|sposto i mattoni|sposto i mattoni crollati|alzo i mattoni","target":"diario1"},{"label":"spengo la torcia","target":"stanza6nolig"}]},{"id":"diario1","text":"Sotto i mattoni trovi un vecchio diario scolastico malandato con scritto.\\n\nI.C. Malaspina.\\n\\n\n\nLa pagina con il nome è stata strappata.\\n\nNelle altre pagine ci sono scarabocchi.\\n\\n\n\nAl giorno 9 ottobre c'è scritto \"ti osservo\".\\n","choices":[{"label":"torno indietro|indietro","target":"stanza6"}]},{"id":"stanza6nolig","text":"Non vedi nulla.","choices":[{"label":"accendo la torcia","target":"stanza6"}]},{"id":"stanza7","text":"Sulla parete a nord c'è un cancello chiuso da una catena, sulla parete a ovest ci sono delle leve arrugginite.\\n\nA sud un corridoio da dove sei arrivato.","choices":[{"label":"vado a sud|sud","target":"stanza5"},{"label":"guardo la parete a nord|parete a nord|nord|cancello|guardo il cancello|catena","target":"cancello1"},{"label":"guardo le leve|mi avvicino alle leve|vado a ovest|ovest|osservo le leve","target":"leve1"},{"label":"spengo la torcia","target":"stanza7nolig"}]},{"id":"stanza7nolig","text":"Non vedi nulla","choices":[{"label":"accendo la torcia","target":"stanza7"}]},{"id":"cancello1","text":"Osservi il cancello.\\n\nE' chiuso da una catena arrugginita e non c'è nessun lucchetto.","choices":[{"label":"apro il cancello|colpisco il cancello|muovo il cancello","target":"cancello1clos"}]},{"id":"cancello1clos","text":"Il cancello non si apre","choices":[{"label":"indietro|vado indietro","target":"stanza7"}]},{"id":"leve1","text":"Le leve sono arrugginite ma sembrano potersi muovere.\\n\nSotto di essere una placca di metallo, anch'essa arrugginta, ha incisa una operazione matematica.\\n\nQuale leva devi tirare?\\n","choices":[],"quiz":{"items":[{"prompt":"34 ∶ 17 − 38 ∶ 19 + 625 ∶ 25 + 36 ∶ 6 ∶ 6 − 123 ∶ 41=","ok":["23"]},{"prompt":"99+35x12-27x11:9+639:639+0:876-76:1-445:89-233=","ok":["173"]},{"prompt":"0:239+56:1-875:875-486:9+123-980:10+78:13x12=","ok":["98"]}],"onCorrect":"scalefin"}},{"id":"scalefin","text":"La leva che hai tirato smuove un meccanismo che cigolando fa tremare le pareti.\\n\nIl soffitto inizia a cedere e crollano i mattoni.\\n\nLa porta si piega e rompe la catena, corri via attraverso di essa poco prima che la stanza crolli inesorabilmente.\\n\nTi ritrovi all'inizio di una scalinata, in cima vedi una porta da cui passa una tenue luce.\\n\\n\n\nFINE DELL'AVVENTURA (per ora...)\n\n(hai trovato tutti i segreti? sono 3)","choices":[]},{"id":"corridoio2","text":"La porta si apre e ti trovi in un lungo corridoio che continua verso nord.\\n\nA sud la stanza iniziale","choices":[{"label":"vado a nord|nord","target":"stanza4"},{"label":"vado a sud|sud","target":"stanza1"}]}]};  let player = { name:"" };  let activeQuiz = {};     let usedIdx = {};        function $(s){ return document.querySelector(s); }  function esc(s){ return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"); }  function norm(s){ s=String(s||"").toLowerCase(); if(s.normalize){s=s.normalize("NFD").replace(/[\u0300-\u036f]/g,"");} s=s.replace(/\s+/g," ").trim(); return s; }  function stripSpacesLower(s){ return String(s||"").toLowerCase().replace(/\s+/g,""); }  function htmlFromText(txt){    var t = String(txt||"");    t = t.replace(/\\n/g,"\n");    t = t.split("{{nome}}").join(player.name);    t = esc(t).replace(/\n/g,"<br>");    return t;  }  function start(){    const root = $("#root");    var h = "" +      "<h1>"+esc(story.title||"Avventura")+"</h1>"+      "<div class=\"small\">Avventura testuale — digita i comandi (es. <i>attraverso la porta</i>)</div>"+      "<div style=\"margin:12px 0\">"+        "<label class=\"small\">Il tuo nome</label>"+        "<input id=\"pname\" placeholder=\"Es. Paola\">"+      "</div>"+      "<input type=\"button\" id=\"btnBegin\" value=\"Inizia\">";    root.innerHTML = h;    document.getElementById("btnBegin").addEventListener("click", begin);  }  function begin(){    var v = (document.getElementById("pname").value||"").trim();    player.name = v || "Viaggiatore";    goto(story.start || (story.nodes[0] && story.nodes[0].id) || "");  }  function nodeById(id){ var list = story.nodes||[]; for(var i=0;i<list.length;i++){ if(list[i].id===id) return list[i]; } return null; }  function pickIdxFor(nodeId, itemsLen){    var used = usedIdx[nodeId] || (usedIdx[nodeId]=[]);    if(itemsLen<=0) return -1;    if(used.length >= itemsLen) used.length = 0;    var pool = []; for(var i=0;i<itemsLen;i++){ if(used.indexOf(i)===-1) pool.push(i); }    var idx = pool[Math.floor(Math.random()*pool.length)];    used.push(idx);    return idx;  }  function ensureActiveQuiz(n){    if(!n.quiz || !Array.isArray(n.quiz.items) || !n.quiz.items.length) return null;    var cur = activeQuiz[n.id];    if(cur && cur.itemsLen===n.quiz.items.length) return cur;    var idx = pickIdxFor(n.id, n.quiz.items.length);    if(idx<0) return null;    var it = n.quiz.items[idx];    activeQuiz[n.id] = { idx:idx, prompt:String(it.prompt||""), ok:(it.ok||[]).slice(), itemsLen:n.quiz.items.length };    return activeQuiz[n.id];  }  function goto(id){    var n = nodeById(id);    if(!n){ $("#root").innerHTML = "<div>Scena non trovata: "+esc(id)+"</div>"; return; }    renderScene(n);  }  function renderScene(n){    var quiz = ensureActiveQuiz(n);    var base = String(n.text||"");    if(quiz){      if(base.indexOf("{{prompt}}")!==-1){        base = base.replace(/\{\{prompt\}\}/g, quiz.prompt);      } else {        base = base + (base?"\n\n":"") + quiz.prompt;      }    }    var html = "";    html += "<h1>"+esc(story.title||"Avventura")+"</h1>";    html += "<div class=\"small\">Scena: <b>"+esc(n.id)+"</b></div>";    html += "<div style=\"line-height:1.5;margin:10px 0 12px; text-align:left\">"+ htmlFromText(base) +"</div>";    html += "<input id=\"cmd\" placeholder=\"Scrivi un'azione o la risposta e premi Invio\">";    html += "<div id=\"msg\" class=\"msg\"></div>";    $("#root").innerHTML = html;    var inp = document.getElementById("cmd"); inp.focus();    inp.addEventListener("keydown", function(ev){ if(ev.key==="Enter"){ var raw = inp.value; inp.value=""; handleCommand(n, raw); } });  }  function matchAnswer(raw, ok){    return stripSpacesLower(raw) === stripSpacesLower(ok);  }  function handleCommand(n, raw){    var quiz = (n.quiz && n.quiz.items && n.quiz.items.length) ? activeQuiz[n.id] : null;    if(quiz && quiz.ok && quiz.ok.length){      for(var i=0;i<quiz.ok.length;i++){ if(matchAnswer(raw, quiz.ok[i])){ if(n.quiz.onCorrect){ delete activeQuiz[n.id]; goto(n.quiz.onCorrect); return; } } }    }    var user = norm(raw); if(!user){ showMsg("⚠️ Digita qualcosa."); return; }    var ch = n.choices || [];    for(var j=0;j<ch.length;j++){      var patterns = String(ch[j].label||"").split("|");      for(var k=0;k<patterns.length;k++){ var p = norm(patterns[k]); if(p && user===p){ goto(ch[j].target||""); return; } }    }    showMsg("❓ Non succede nulla… (comando non riconosciuto)");  }  function showMsg(txt){ var el = document.getElementById("msg"); if(el){ el.className = "msg warn"; el.innerHTML = esc(txt); } }  window.addEventListener("DOMContentLoaded", start);})();</script></body></html>
